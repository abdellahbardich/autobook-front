<!-- conversation-list.component.html -->
<div class="conversation-list-container">
    <div class="header">
      <div class="header-left">
        <h1>Your Conversations</h1>
        <p class="subtitle">Create and manage your book conversations</p>
      </div>
      <button class="btn btn-primary new-convo-btn" (click)="toggleNewConversationForm()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>New Conversation</span>
      </button>
    </div>
  
    <div class="new-conversation-form" *ngIf="showNewConversationForm">
      <div class="form-card">
        <div class="form-header">
          <h3>Start a New Conversation</h3>
          <button class="btn-close" (click)="toggleNewConversationForm()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
  
        <form [formGroup]="newConversationForm" (ngSubmit)="createConversation()">
          <div class="form-section">
            <div class="form-group">
              <label for="title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                  <line x1="16" y1="8" x2="2" y2="22"></line>
                  <line x1="17.5" y1="15" x2="9" y2="15"></line>
                </svg>
                Conversation Title
              </label>
              <input
                type="text"
                id="title"
                formControlName="title"
                class="form-control"
                placeholder="E.g., Fantasy Adventure Book"
              />
            </div>
  
            <div class="form-group">
              <label for="initialMessage">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Initial Message
              </label>
              <textarea
                id="initialMessage"
                formControlName="initialMessage"
                class="form-control"
                rows="3"
                placeholder="E.g., I want to create a fantasy adventure book about a young wizard."
              ></textarea>
            </div>
          </div>
  
          <div class="form-divider">
            <span>Book Parameters</span>
          </div>
  
          <div class="form-section parameters-grid">
            <div class="form-group">
              <label for="bookType">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                Book Type
              </label>
              <div class="custom-select">
                <select 
                  id="bookType" 
                  formControlName="bookType" 
                  class="form-control"
                >
                  <option [value]="BookType.TEXT_ONLY">Text Only</option>
                  <!-- <option [value]="BookType.IMAGE_ONLY">Image Only</option> -->
                  <option [value]="BookType.TEXT_IMAGE">Text and Images</option>
                </select>
                <svg class="select-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
  
            <div class="form-group">
              <label for="stylePrompt">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                Style Prompt
              </label>
              <input
                type="text"
                id="stylePrompt"
                formControlName="stylePrompt"
                class="form-control"
                placeholder="E.g., Fantasy, magical, colorful"
              />
            </div>
  
            <div class="form-group">
              <label for="numChapters">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="8" y1="6" x2="21" y2="6"></line>
                  <line x1="8" y1="12" x2="21" y2="12"></line>
                  <line x1="8" y1="18" x2="21" y2="18"></line>
                  <line x1="3" y1="6" x2="3.01" y2="6"></line>
                  <line x1="3" y1="12" x2="3.01" y2="12"></line>
                  <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                Number of Chapters
              </label>
              <div class="number-input">
                <input
                  type="number"
                  id="numChapters"
                  formControlName="numChapters"
                  class="form-control"
                  min="1"
                  max="10"
                />
                <div class="number-controls">
                  <button type="button" class="number-up" tabindex="-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                  </button>
                  <button type="button" class="number-down" tabindex="-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
  
            <div class="form-group illustration-toggle">
              <div class="toggle-container">
                <label for="includeIllustrations" class="toggle-label">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                  Include Illustrations
                </label>
                <div class="toggle-switch">
                  <input
                    type="checkbox"
                    id="includeIllustrations"
                    formControlName="includeIllustrations"
                    class="toggle-input"
                  />
                  <label for="includeIllustrations" class="toggle"></label>
                </div>
              </div>
            </div>
          </div>
  
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="toggleNewConversationForm()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="newConversationForm.invalid || loading"
            >
              <span
                *ngIf="loading"
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"
              ></span>
              <span>Start Conversation</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  
    <div class="conversations-grid" *ngIf="conversations.length > 0">
      <div
        class="conversation-card"
        *ngFor="let conversation of conversations"
      >
        <div class="card-content" (click)="
          conversation.conversationId
            ? openConversation(conversation.conversationId)
            : null
        ">
          <div class="card-top">
            <div class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
            </div>
            <div class="card-badge">Story</div>
          </div>
          <div class="conversation-title">{{ conversation.title }}</div>
          <div class="conversation-preview">Your creative journey starts here. Tap to continue writing your story.</div>
          <div class="conversation-metadata">
            <div class="conversation-date">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              {{ conversation.createdAt | date : "MMM d, yyyy" }}
            </div>
            <div class="conversation-time">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              {{ conversation.createdAt | date : "shortTime" }}
            </div>
          </div>
          <div class="card-progress">
            <div class="progress-bar" style="width: 65%"></div>
            <span class="progress-text">In Progress</span>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="action-btn btn-edit">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span class="tooltip">Edit</span>
          </button>
          <button class="action-btn btn-share">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
            <span class="tooltip">Share</span>
          </button>
          <button
            class="action-btn btn-delete"
            (click)="deleteConversation($event, conversation.conversationId)"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            <span class="tooltip">Delete</span>
          </button>
        </div>
        
        <div class="delete-confirm">
          <p>Delete this conversation?</p>
          <div class="delete-actions">
            <button class="btn-cancel">Cancel</button>
            <button class="btn-confirm">Delete</button>
          </div>
        </div>
      </div>
    </div>
  
    <div class="empty-state" *ngIf="!loading && conversations.length === 0">
      <div class="empty-state-content">
        <div class="empty-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        </div>
        <h3>No conversations yet</h3>
        <p>Start your first conversation to begin creating amazing books!</p>
        <button class="btn btn-primary" (click)="toggleNewConversationForm()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>Start a Conversation</span>
        </button>
      </div>
    </div>
  
    <div class="alert alert-danger" *ngIf="error">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>{{ error }}</span>
      <button class="btn-close-alert">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  
    <div class="loading-state" *ngIf="loading && !showNewConversationForm">
      <div class="spinner">
        <svg viewBox="0 0 50 50" class="loading-spinner">
          <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
        </svg>
      </div>
      <p>Loading your conversations...</p>
    </div>
  </div>